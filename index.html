<!DOCTYPE html>
<html>
<head>
  <title>Open in App</title>
  <style>
    #popup {
      display: none;
      position: fixed;
      z-index: 9999;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }

    #popupContent {
      background: #fff;
      padding: 20px 30px;
      border-radius: 8px;
      text-align: center;
      max-width: 300px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    #popupContent button {
      margin: 10px;
      padding: 10px 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<!-- Fallback CTA for Instagram users -->
<div style="text-align:center; margin-top: 100px;">
  <p>This content is best viewed in the app.</p>
  <button onclick="showPopup()">Open in App</button>
</div>

<!-- Internal popup -->
<div id="popup">
  <div id="popupContent">
    <p>Do you want to open this content in the app?</p>
    <button onclick="openApp()">OPEN</button>
    <button onclick="closePopup()">CANCEL</button>
  </div>
</div>

<script>
function showPopup() {
  document.getElementById('popup').style.display = 'flex';
}

function closePopup() {
  document.getElementById('popup').style.display = 'none';
}

function openApp() {
  closePopup();

  const androidPackageName = 'com.astro.astro';
  const deepLink = 'https://links-astrostgeks.vsscloud-astro-stg.tv/content/abc123~xyz~vod'; 
  const strippedReferrer = deepLink.replace(/^https?:\/\//, '');
  const playStoreUrl = `https://play.google.com/store/apps/details?id=${androidPackageName}&referrer=${encodeURIComponent(deepLink)}`;

  const intentUrl = `intent://${strippedReferrer}#Intent;scheme=https;package=${androidPackageName};S.browser_fallback_url=${encodeURIComponent(playStoreUrl)};end;`;

  window.location.href = intentUrl;
}
</script>

</body>
</html>
