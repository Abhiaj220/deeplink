<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title></title>
	<meta property='og:image:width' content='640' />
	<meta property='og:image:height' content='640' />
	<meta name='twitter:card' content='summary_large_image' />
	<meta name='twitter:site'
		content='https://links-astrostgeks.vsscloud-astro-stg.tv.s3.ap-southeast-1.amazonaws.com/content/36ed2348-26e6-5fd7-a296-230bb038d017~CATC0000000001014675~vod' />
	<meta property='og:url'
		content='https://links-astrostgeks.vsscloud-astro-stg.tv.s3.ap-southeast-1.amazonaws.com/content/36ed2348-26e6-5fd7-a296-230bb038d017~CATC0000000001014675~vod' />

	<style>
		body {
			position: relative;
			height: 100vh;
		}

		   /* Popup styles */
    #popup {
      display: none;
      position: fixed;
      z-index: 9999;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }

    #popupContent {
      background: #fff;
      padding: 20px 30px;
      border-radius: 8px;
      text-align: center;
      max-width: 300px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    #popupContent button {
      margin: 10px;
      padding: 10px 20px;
      cursor: pointer;
    }

		.text-container {
			position: absolute;
			top: 40%;
			left: 50%;
			transform: translate(-50%, -50%);
			text-align: center;
		}

		.text {
			font-weight: 600;
			font-size: 20px;
			margin-bottom: 50px;
		}

		button {
			position: relative;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			padding: 10px 24px;
			background-color: white;
			border: 1px solid #d1d1d1;
			border-radius: 3px;
			color: #007aff;
			font-weight: 600;
			font-size: 16px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.40);
			cursor: pointer;
			outline: none;
			transition: background-color 0.2s ease;
		}
	</style>
</head>

<body>
	<script type="module">
		(function() {
        // Device detection functions
        function isAndroid() {
			if(/Android/i.test(navigator.userAgent)){
				showPopup();
			}
            return /Android/i.test(navigator.userAgent);
        }

        function isIOS() {
            return /iPhone|iPad|iPod/i.test(navigator.userAgent) ||
                // iPadOS 13+ pretends to be Mac, but has touch support
                (navigator.userAgent.includes('Macintosh') && 'ontouchend' in document);
        }

        function isBrowser() {
            return (typeof window !== "undefined" && typeof document !== "undefined");
        }

			function showPopup() {
  document.getElementById('popup').style.display = 'flex';
}

function closePopup() {
  document.getElementById('popup').style.display = 'none';
}

        window.setTimeout(function () {
            // Redirect logic
            if (isAndroid()) {
				closePopup();
                // ssr - androidPackageName need to take the value from a pillat varaible. Template it or inform Ilay to take care of the same.
                const androidPackageName = 'com.astro.astro'; // <-- Replace with your Android app's package name
                const referrer = `https://links-astrostgeks.vsscloud-astro-stg.tv/content/36ed2348-26e6-5fd7-a296-230bb038d017~CATC0000000001014675~vod?contentType=content&utm_source=clevertap&utm_medium=post&utm_campaign=Astro&target=actionMenu&socialTitle=My+Chemical+Romance_Cancer&socialDescription=Short+Synopsis+-+English&socialImageLink=http%3A%2F%2Fstaging-vod-poster.astro.com.my%2Fposter%2FIVP%28STB_OTT_STV%29_Idiot_IVP_LAND_917x516_F7B93_20241129_105743.jpg&contentId=36ed2348-26e6-5fd7-a296-230bb038d017%7ECATC0000000001014675%7Evod` // <-- full url
                const playStoreUrl = `https://play.google.com/store/apps/details?id=${androidPackageName}&referrer=${encodeURIComponent(referrer)}`;
				  const strippedReferrer = deepLink.replace(/^https?:\/\//, '');

  const playStoreUrl = `https://play.google.com/store/apps/details?id=${androidPackageName}&referrer=${encodeURIComponent(deepLink)}`;

  const intentUrl = `intent://${strippedReferrer}#Intent;scheme=https;package=${androidPackageName};S.browser_fallback_url=${encodeURIComponent(playStoreUrl)};end;`;

  window.location.href = intentUrl;
            } else if (isIOS()) {
                // ssr - iosAppId need to take the value from a pillat varaible. Template it or inform Ilay to take care of the same.
                const iosAppId = '521993797'; // <-- Replace with your iOS app's App Store ID
                const appStoreUrl = `itms-apps://itunes.apple.com/app/id${iosAppId}`;
                const referrer = `https://links-astrostgeks.vsscloud-astro-stg.tv/content/36ed2348-26e6-5fd7-a296-230bb038d017~CATC0000000001014675~vod?contentType=content&utm_source=clevertap&utm_medium=post&utm_campaign=Astro&target=actionMenu&socialTitle=My+Chemical+Romance_Cancer&socialDescription=Short+Synopsis+-+English&socialImageLink=http%3A%2F%2Fstaging-vod-poster.astro.com.my%2Fposter%2FIVP%28STB_OTT_STV%29_Idiot_IVP_LAND_917x516_F7B93_20241129_105743.jpg&contentId=36ed2348-26e6-5fd7-a296-230bb038d017%7ECATC0000000001014675%7Evod`; // `${referrer}` // <-- full url

                const divElement = document.createElement('div');
                divElement.classList.add('text-container');
                const reasonText = document.createElement('p');
                reasonText.classList.add('text');
                // ssr - the text and styling need to be redone to match Astro requirement. Ask Bindiya for the UI definition.
                reasonText.textContent = 'Open link in app?';
                divElement.appendChild(reasonText);
                document.body.appendChild(divElement);

                const agreeButton = document.createElement('button');
                // ssr - Same as text. The button styling, title need to be redone to match Astro requirement. Ask Bindiya for the UI definition.
                agreeButton.textContent = 'OPEN';
                agreeButton.onclick = function() {
                    // Redirect to the App Store and write to clipboard
                    navigator.clipboard.writeText(`referrer=${encodeURIComponent(referrer)}`)
                        .then(() => {
                            console.log(`Written to device clipboard - referrer=${encodeURIComponent(referrer)}`);
                        })
                        .catch(err => {
                            console.error('Failed to write to clipboard:', err);
                        });

                        let openedApp = false;
                        const onVis = () => {
                            if (document.visibilityState === 'hidden') openedApp = true;
                        };

                        const onPageHide = () => {
                            openedApp = true;
                        };
						
                        document.addEventListener('visibilitychange', onVis, { once: true });
                        window.addEventListener('pagehide', onPageHide, { once: true });
						
                        window.location = `synaottlink${iosAppId}://${encodeURIComponent(referrer)}`;                        
                        
                        window.setTimeout(function(){
							document.removeEventListener('visibilitychange', onVis);
                            window.removeEventListener('pagehide', onPageHide);

                            if (openedApp) { //link is already opened in the app. No need to redirect to App Store
                                return;
                            }

                            window.location = appStoreUrl;
                        },2000);
                };
                document.body.appendChild(agreeButton);
            } else if (isBrowser()) {
                // For desktop
                const desktopFallback = `https://web.astro-stg.com/campaign_management?`; // <-- Replace with Web UI host and query params from the full URL
                window.location = desktopFallback;
            } else {
                document.body.innerHTML = '<p>This link is intended for Android or iOS device or Chrome, Firefox and Safari web browsers. Please open it on a compatible device.</p>';
            }
        }, 1000);
    })();

</script>
</body>

<!-- Internal popup -->
<div id="popup">
  <div id="popupContent">
    <p>Do you want to open this content in the app?</p>
    <button onclick="openApp()">OPEN</button>
    <button onclick="closePopup()">CANCEL</button>
  </div>
</div>

</html>
